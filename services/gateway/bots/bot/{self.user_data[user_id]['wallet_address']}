
**ğŸ“‹ ×”×•×¨××•×ª:**
1. ×©×ª×£ ×›×ª×•×‘×ª ×–×• ×¢× ×”×©×•×œ×—
2. ×”××ª×Ÿ ×œ×§×‘×œ×ª ×”×¢×¡×§×”
3. ×”××™×–×•×Ÿ ×™×ª×¢×“×›×Ÿ ××•×˜×•××˜×™×ª

ğŸ’¡ *×× ×©×™× ×™×›×•×œ×™× ×œ×©×œ×•×— ×œ×š TON ××• ×›×œ ××˜×‘×¢ ×¢×œ ×¨×©×ª TON ×œ×›×ª×•×‘×ª ×–×•.*
            """
            self.bot.send_message(message.chat.id, address_text, parse_mode='Markdown')

        @self.bot.message_handler(func=lambda message: message.text == 'ğŸ”— ×›×ª×•×‘×ª ×©×œ×™')
        def my_address_handler(message):
            user_id = message.from_user.id
            if user_id not in self.user_data:
                self.user_data[user_id] = {
                    'wallet_address': self.generate_wallet_address(),
                    'balance': 0.0
                }
                
            address_info = f"""
ğŸ”— **×›×ª×•×‘×ª ×”××¨× ×§ ×©×œ×š:**

**ğŸ“§ ×›×ª×•×‘×ª ××œ××”:**
`{self.user_data[user_id]['wallet_address']}`

**ğŸŒ ×¨×©×ª:** TON Mainnet
**ğŸ’¼ ×¡×•×’:** ××¨× ×§ v4

**ğŸ“¤ ×œ×©×™×ª×•×£:** ×”×¢×ª×§ ××ª ×”×›×ª×•×‘×ª ×•×©×œ×— ×œ×©×•×œ×—
**ğŸ“¥ ×œ×§×‘×œ×”:** ×©×œ×— ×›×ª×•×‘×ª ×–×• ×œ×›×œ ××™ ×©×¨×•×¦×” ×œ×©×œ×•×— ×œ×š

âš ï¸ **××–×”×¨×”:** ××œ ×ª×©×ª×£ ××ª ××¤×ª×— ×”×¤×¨×˜×™ ×©×œ×š!
            """
            
            markup = types.InlineKeyboardMarkup()
            markup.row(
                types.InlineKeyboardButton("ğŸ“‹ ×”×¢×ª×§ ×›×ª×•×‘×ª", callback_data="copy_address"),
                types.InlineKeyboardButton("ğŸ”„ ×¦×•×¨ ××¨× ×§ ×—×“×©", callback_data="new_wallet")
            )
            
            self.bot.send_message(
                message.chat.id,
                address_info,
                reply_markup=markup,
                parse_mode='Markdown'
            )

        @self.bot.message_handler(func=lambda message: message.text == 'ğŸ“Š ××—×™×¨ TON')
        def price_handler(message):
            price_text = """
ğŸ’ **××—×™×¨ TON ×¢×“×›× ×™:**

**ğŸ’° ××—×™×¨ × ×•×›×—×™:** $2.45
**ğŸ“ˆ ×©×™× ×•×™ 24h:** +5.2%
**ğŸ“Š × ×¤×— 24h:** $85M
**ğŸ•’ ×¢×“×›×•×Ÿ ××—×¨×•×Ÿ:** ×›×¢×ª

**ğŸ“ˆ ×‘×™×¦×•×¢×™×:**
- ğŸŸ¢ ×©×‘×•×¢×™: +12.3%
- ğŸŸ¢ ×—×•×“×©×™: +28.7%
- ğŸ”´ ×©× ×ª×™: -15.2%

*××—×™×¨×™× ××ª×¢×“×›× ×™× ×‘××•×¤×Ÿ ×¨×¦×™×£*
            """
            self.bot.send_message(message.chat.id, price_text, parse_mode='Markdown')

        @self.bot.message_handler(func=lambda message: message.text == 'ğŸ†˜ ×¢×–×¨×”')
        def help_handler(message):
            help_text = """
ğŸ†˜ **××“×¨×™×š ×©×™××•×© ××œ×**

**ğŸ‘› ××™×–×•×Ÿ** - ×”×¦×’×ª ××™×–×•×Ÿ ×”××˜×‘×¢×•×ª
**ğŸ“¤ ×©×œ×— TON** - ×©×œ×™×—×ª TON ×œ××™×©×”×•  
**ğŸ“¥ ×§×‘×œ TON** - ×§×‘×œ×ª ×›×ª×•×‘×ª ××¨× ×§
**ğŸ“Š ××—×™×¨ TON** - ××—×™×¨ TON ×¢×“×›× ×™
**ğŸ”— ×›×ª×•×‘×ª ×©×œ×™** - × ×™×”×•×œ ×•×¤×¨×˜×™ ××¨× ×§

**ğŸ”’ ××‘×˜×—×”:**
- ×œ×¢×•×œ× ××œ ×ª×©×ª×£ ××ª ××¤×ª×— ×”×¤×¨×˜×™
- ×©××•×¨ ×’×™×‘×•×™ ×œ××™×œ×™× ×”×¡×•×“×™×•×ª
- ×•×“× ×©×›×ª×•×‘×•×ª × ×›×•× ×•×ª ×œ×¤× ×™ ×©×™×œ×•×—

**ğŸ“ ×ª××™×›×”:**
×œ×‘×¢×™×•×ª × ×•×¡×¤×•×ª ×¤× ×” ×œ×ª××™×›×” ×”×˜×›× ×™×ª.
            """
            self.bot.send_message(message.chat.id, help_text, parse_mode='Markdown')

    def process_address(self, message):
        address = message.text.strip()
        
        if not ton_manager.validate_address(address):
            self.bot.send_message(
                message.chat.id,
                "âŒ **×›×ª×•×‘×ª ×œ× ×ª×§×™× ×”!**\n\n×× × ×©×œ×— ×›×ª×•×‘×ª TON ×ª×§×™× ×” (××ª×—×™×œ ×‘-EQ ××• kQ):",
                parse_mode='Markdown'
            )
            return
            
        self.bot.send_message(
            message.chat.id,
            f"âœ… **×›×ª×•×‘×ª ×ª×§×™× ×”:** `{address}`\n\n×›×¢×ª ×”×–×Ÿ ××ª ×”×¡×›×•× ×œ×©×™×œ×•×— (×‘-TON):",
            parse_mode='Markdown'
        )
        self.bot.register_next_step_handler(message, self.process_amount, address)

    def process_amount(self, message, address):
        try:
            amount = float(message.text)
            if amount <= 0:
                raise ValueError("×¡×›×•× ×—×™×•×‘×™ ×‘×œ×‘×“")
                
            confirm_text = f"""
ğŸ“¤ **××™×©×•×¨ ×©×™×œ×•×—**

**ğŸ‘¥ ×œ×›×ª×•×‘×ª:** 
`{address}`

**ğŸ’ ×¡×›×•×:** {amount:.4f} TON
**ğŸ’° ××©×•×¢×¨:** ${amount * 2.45:.2f}
**ğŸ“ ×”×¢×¨×”:** ×¢×¡×§×” ××”-TON ×‘×•×˜

**âš ï¸ ××™×©×•×¨ ×¡×•×¤×™:**
×”×× ×œ××©×¨ ××ª ×”×©×™×œ×•×—?
            """
            
            markup = types.InlineKeyboardMarkup()
            markup.row(
                types.InlineKeyboardButton("âœ… ××©×¨ ×©×™×œ×•×—", callback_data=f"confirm_send_{amount}_{address}"),
                types.InlineKeyboardButton("âŒ ×‘×˜×œ", callback_data="cancel_send")
            )
            
            self.bot.send_message(
                message.chat.id,
                confirm_text,
                reply_markup=markup,
                parse_mode='Markdown'
            )
            
        except ValueError:
            self.bot.send_message(
                message.chat.id, 
                "âŒ **×¡×›×•× ×œ× ×ª×§×™×Ÿ!**\n\n×× × ×”×–×Ÿ ×¡×›×•× ××¡×¤×¨×™ ×ª×§×™×Ÿ (×œ×“×•×’××”: 1.5):",
                parse_mode='Markdown'
            )

    @self.bot.callback_query_handler(func=lambda call: True)
    def callback_handler(self, call):
        if call.data.startswith("confirm_send_"):
            try:
                # Extract amount and address from callback data
                parts = call.data.split("_")
                amount = float(parts[2])
                address = "_".join(parts[3:])  # In case address contains underscores
                
                self.bot.edit_message_text(
                    "ğŸ”„ **××¢×‘×“ ×¢×¡×§×”...**\n\n×”×¢×‘×¨×ª ×”-TON ×‘×ª×”×œ×™×š, ×™×ª×¢×“×›×Ÿ ×ª×•×š ××¡×¤×¨ ×“×§×•×ª.",
                    call.message.chat.id,
                    call.message.message_id
                )
                
                # Simulate transaction processing
                success_text = f"""
âœ… **×”×¢×¡×§×” ×‘×•×¦×¢×”!**

**ğŸ“¤ × ×©×œ×—:** {amount:.4f} TON
**ğŸ‘¥ ×œ×›×ª×•×‘×ª:** `{address}`
**ğŸ†” ××–×”×” ×¢×¡×§×”:** `{self.generate_tx_id()}`
**â±ï¸ ×¡×˜×˜×•×¡:** ×××•×©×¨

**ğŸ’ ××™×–×•×Ÿ ××¢×•×“×›×Ÿ:** 0.00 TON
                """
                
                self.bot.send_message(
                    call.message.chat.id,
                    success_text,
                    parse_mode='Markdown'
                )
                
            except Exception as e:
                self.bot.edit_message_text(
                    "âŒ **×©×’×™××” ×‘×¢×™×‘×•×“ ×”×¢×¡×§×”**\n\n×× × × ×¡×” ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨.",
                    call.message.chat.id,
                    call.message.message_id
                )
                
        elif call.data == "cancel_send":
            self.bot.edit_message_text(
                "âŒ **×”×¢×¡×§×” ×‘×•×˜×œ×”**\n\n×”×©×™×œ×•×— ×œ× ×‘×•×¦×¢.",
                call.message.chat.id,
                call.message.message_id
            )
            
        elif call.data == "copy_address":
            self.bot.answer_callback_query(call.id, "ğŸ“‹ ×”×›×ª×•×‘×ª ×”×•×¢×ª×§×”!")
            
        elif call.data == "new_wallet":
            self.bot.edit_message_text(
                "ğŸ”„ **×™×•×¦×¨ ××¨× ×§ ×—×“×©...**\n\n×× × ×”××ª×Ÿ...",
                call.message.chat.id,
                call.message.message_id
            )
            
            # Simulate wallet creation
            new_wallet_text = """
âœ… **××¨× ×§ ×—×“×© × ×•×¦×¨!**

**ğŸ” ××¨× ×§ ×—×“×© × ×•×¦×¨ ×‘×”×¦×œ×—×”.**
**ğŸ“§ ×”×›×ª×•×‘×ª ×”×—×“×©×” ×ª×•×¦×’ ×‘×¢×•×“ ××¡×¤×¨ ×©× ×™×•×ª.**

âš ï¸ **×—×©×•×‘:** ×©××•×¨ ××ª ××¤×ª×— ×”×’×™×©×” ×”×—×“×© ×‘××§×•× ×‘×˜×•×—!
            """
            
            self.bot.send_message(
                call.message.chat.id,
                new_wallet_text,
                parse_mode='Markdown'
            )

    def generate_wallet_address(self):
        """Generate mock wallet address"""
        return "EQ" + ''.join(random.choices(string.ascii_uppercase + string.digits, k=48))

    def generate_tx_id(self):
        """Generate mock transaction ID"""
        chars = string.hexdigits.lower()
        return ''.join(random.choice(chars) for _ in range(64))

    def run(self):
        """Start the bot"""
        print(f"ğŸ¤– Starting TON Coin Bot...")
        self.bot.infinity_polling(timeout=60, long_polling_timeout=60)

def create_ton_bot(token):
    """Factory function to create TON bot instance"""
    return TONCoinBot(token)
